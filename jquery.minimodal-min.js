/*
 * jQuery miniModal Plugin v.6 (pre-release)
 * @author Mike Kuzin http://mikekuzin.com 
 * Kudos to Nate Good (http://nategood.com)
 * Kudos to Pat Collins (http://www.burned.com/)
 * ---------------------------------------
 * Copyright (c) 2011 Mike Kuzin & Peeps
 * ---------------------------------------
 */
(function(g){g.miniModal=function(p,o){return g.miniModal.run.init(p,o);};g.miniModal.init=function(p,o){g.miniModal.run.init(p,o);};g.miniModal.create=function(p,o){g.miniModal.run.create(p,o);};g.miniModal.load=function(p,o){g.miniModal.run.load(p,o);};g.miniModal.display=function(p,o){g.miniModal.run.display(p,o);};g.miniModal.resize=function(p,o){g.miniModal.run.resizer(p,o);};g.miniModal.close=function(p,o){g.miniModal.run.close(p,o);};g.miniModal.kill=function(p,o){g.miniModal.run.kill(p,o);};g.fn.miniModal=function(o){return g.miniModal.run.init(this,o);};g.miniModal.defaults={load:"",appendTo:"body",closeTxt:"[close]",focus:true,fade:0,height:null,width:null,close:true,escClose:true,overlayClose:true,position:true,absolute:false,modal:true,overlay:true,overlayId:"overlay",modalId:"modal_base",closeId:"modal_close",onOpen:function(){},onCreate:function(){},onLoad:function(){},onDisplay:function(){},onClose:function(){},onResize:function(){},onKill:function(){},beforeClose:function(){},style:"modal"};var i=function(q,o){var p=document.createElement("div");if(q){p.id=q;}return g(p);};var k,b,n,c,m,j,d,l,h,a,f;var e=g.miniModal.defaults;g.miniModal.run={init:function(o){e=g.extend(true,{},g.miniModal.defaults,o);e.onOpen.call();g.miniModal.run.display();if(e.overlayClose==true){k.click(function(){g.miniModal.close();});}if(l){l.click(function(){e.beforeClose.call();g.miniModal.close();});}g(document).keydown(function(p){var q=g("#loading").is(":visible");if(p.keyCode==27&&e.close==true&&e.escClose==true&&q!=true){e.beforeClose.call();p.preventDefault();g.miniModal.close();}});},display:function(){e.onDisplay.call();if(g("#overlay").length==0){g.miniModal.run.create();}else{g.miniModal.run.load();}},create:function(){e.onCreate.call();a=e.appendTo;if(a!="body"){a="#"+e.appendTo;}d=g(window);k=i(e.overlayId).hide();if(e.overlay==false){k.css("opacity",0);}b=i(e.modalId);l=i(e.closeId);g(a).prepend(b.append(l),k);g.miniModal.run.load();g.miniModal.run.resizer();},load:function(){b.removeAttr("style");if(e.style==null){b.html(e.load);l.html(e.closeTxt);}else{b.html(e.load).append(l).wrapInner("<span />").wrapInner('<div class="'+e.style+'" />');l.html(e.closeTxt);}if(e.height!=null){b.css({height:e.height});}if(e.width!=null){b.css({width:e.width});}if(e.fade!=0){if(e.overlay!=false){k.fadeIn(e.fade);}else{k.show().css({opacity:0});}if(e.modal==true){b.fadeIn(e.fade);}if(l){if(e.close!=true){l.hide();}else{l.show();}}}else{if(e.overlay!=false){k.show();}else{k.show().css({opacity:0});}b.show();k.show();if(l){if(e.close!=true){l.hide();}else{l.show();}}}g.miniModal.run.resizer();e.onLoad.call();},resizer:function(){e.onResize.call();var o,p;if(e.position==true){o=(b.width())/2;if(l){p=((b.height())/2)+25;}else{p=(b.height())/2;}b.css({top:"50%",left:"50%",marginLeft:-o,marginTop:-p});}if(e.absolute==true){b.css({height:"100%",width:"100%"});}},close:function(){e.onClose.call();if(e.fade!=false){b.fadeOut(e.fade);k.fadeOut(e.fade);if(l){l.fadeOut(e.fade);}}else{b.hide();k.hide();if(l){l.hide();}}},kill:function(){e.onKill.call();if(e.fade!=false){b.fadeOut(e.fade);k.fadeOut(e.fade);setTimeout(function(){b.remove();k.remove();if(l){l.remove();}},e.fade+10);}else{b.remove();k.remove();if(l){l.remove();}}}};})(jQuery);